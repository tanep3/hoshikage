# 非機能要件詳細定義 (NFR Details)

**バージョン:** 1.0.0  
**作成日:** 2026-01-18  

---

## 1. スケーラビリティ (Scalability)

### 1.1 シングルユーザー特化戦略 (SCL-001)
星影はローカルPCでの個人利用を主眼としています。「静かなる知性」を実現するため、並列処理よりもリソースの安定性を優先します。

- **同時実行数制限 (Semaphore)**: 同時に処理する推論タスクは常に **1つ** に制限します。
- **キューイング**: 2つ目以降のリクエストは待機状態（Pending）となり、前のタスクが完了次第処理されます。
- **タイムアウト**: 待機時間が 60秒 を超えた場合、リクエストはタイムアウトエラー (429/503) を返します。

## 2. ログと監視 (Logging & Monitoring)

### 2.1 ログ設計 (MNT-002)
運用時のトラブルシューティングに必要な情報を記録します。

- **フォーマット**: 構造化ログは使用せず、読みやすいテキスト形式（ユーザー向け）または単純なJSONログ（開発者向け）を検討。現状は標準出力(stdout/stderr)を使用。
- **ログレベル**:
  - `INFO`: 起動、モデルロード完了、推論開始/終了、アンロード
  - `WARN`: 非推奨な設定、GPUメモリ逼迫警告
  - `ERROR`: パニック、ライブラリロード失敗、I/Oエラー

### 2.2 ヘルスチェック
`/v1/status` エンドポイントにより、外部ツール（またはユーザーの手動確認）で死活監視が可能です。

## 3. 信頼性 (Reliability)

### 3.1 自動復旧 (REL-001)
- **ライブラリクラッシュ**: Rust側で `catch_unwind` はFFI境界でのクラッシュを完全には防げないため、基本的にはプロセスが終了します。systemd 等の外部サービスマネージャーによる自動再起動 (`Restart=on-failure`) に依存します。
- **モデルロード失敗**: 不正なGGUFファイル等でロードに失敗した場合、システムは終了せず、エラーをAPIレスポンスとして返します。

## 4. セキュリティ (Security)

### 4.1 ローカル動作の保証 (SEC-001)
- 外部APIへの通信機能を持たせず、インバウンド通信（APIリクエスト受信）とローカルファイルアクセスのみに機能を限定します。

---
